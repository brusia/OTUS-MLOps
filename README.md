# OTUS-MLOps

Данный репозиторий создан для выполнения домашних заданий по курсу MLOps платформы обучения OTUS.

<!-- Start of Hometask 7 block -->

## Задание 7

### Описание изменений

В рамках выполнения домашнего задания 7 разработан скрипт оптимизации (подбора параметров) модели с использованием hyperopt, работающей с распределёнными данными в Spark кластере.

Кроме того, был разработан скрипт для сравнения точности полученной оптимизированной модели с исходной (обученной в рамках предыдущего шага конвейера обработки данных, реализованного в предыдущем задании курса) с помощью реализованного bootstrap тестирования.

По результатам оценки точности принимается решение о выборе текущей production версии модели (тег champion остаётся у исходной модели либо назначается на оптиимизированную модели в случае улучшения показателей).

В разработанный airflow даг внесён дополнительный шаг с оптимизацией модели.

[Airflow Dag Sample](docs/hometasks/07/dag.png)

В MLFlow оптимизация логируется как отдельный эксперимент "mlflow-experiment-opt".

[MLFlow runs list](docs/hometask/07/mlflow_runs.png)

Реестр моделей обновляется в соответствии с описанными правилами

[MLFlow Model Registy](docs/hometask/07/model_registry.png)

Модели, полученные в ходе оптимизации доступны по ссылке:

s3://brusia-bucket/models/fraud_detection_validate/

Для экономии остатков денежных средств промокода для выполнения задания проведено три итерации переобучения (airflow dag отработал трижды, после чего был остановлен): для демонстрации работоспособности этого должно быть достаточно.

### Примечания

- Заметим, что исходный датасет и физический смысл обрабатываемых данных (мошеннические транзакции) таков, что размеры классов несбалансированы (мошеннических транзакцией существенно меньше, чем обычных). Так как в качестве обучаемой архитектуры мы используем модель случайного леса, которая чувствительна к такому смещению, для балансировки при анализе точности используется дополнительный столбец веса, характеризующий вес значения признака для обучаемой модели. (Evalutors, естественно, также используют столбец с весом признаков во время оценки точности).

- Из-за отладки при процессе разработки в списке версий (в реестре моделей) осталось несколько предыдущих моделей. По дате добавления можно понять, что они были созданы вне запусков по расписанию.

- В ходе выполнения текущего задания было сгенерировано какое-то количество технического долга. С точки зрения опрятности кода и его организации есть над чем поработать: в github отражены соответствующие задачи, однако в рамках выполнения заданий курса работа над ними представляется избыточной.

- Статусы задач поддерживаются в актуальном состоянии на протяжении всей работы. Kandan-доска доступна по ссылке:

[Tasks View](https://github.com/users/brusia/projects/1/views/1)

<!-- End of Hometask 7 block. -->

## Oбщие положения

Для экономии места выполненные (и принятые) задания перемещены из главного файла README.md текущего репозитория и скрыты в соответствующих каталогах (docs/hometasks/<task_number>/hometask<task_number>.md)

Актуальное задание (для проверки) будет размещено в текущей версии README.md
Список предыдущих заданий

[Hometask 1](docs/hometasks//01/hometask1.md)
[Hometask 2](docs/hometasks/02/hometask2.md)
[Hometask 3](docs/hometasks/03/hometask3.md)
[Hometask 5](docs/hometasks/05/hometask5.md)
[Hometask 6](docs/hometasks/06/hometask06.md)
[Hometask 7](docs/hometasks/07/hometask07.md)
