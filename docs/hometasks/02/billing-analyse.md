<!-- TODO. -->

# Затраты на поддержание работоспособности spark-кластера

<!-- TO BE ADDED. -->

# Сравнение cодержания spark-кластера и объектного хранилища

<!-- TO BE ADDED. -->

# Оптимизация затрат

В качестве оптимизации затрат на содержание инфраструктуры предлагается соорудить небольшую матрёшку: выделить виртуальную машину (управляющий proxy) в отдельный управляющий модуль (по аналогии с тем, как это сейчас сделано для объектного хранилища), которая будет управлять скриптами разворачивания инфраструктуры spark-кластера.

Настроить её таким образом, чтобы при запуске, например, make compute запускалось последовательно:

1. Создание dataproc-кластера и копирование на него данных из целевого бакета (частично реализовано в текущем подходе)
2. Выполнение полезной работы: запуск целевых функций, работа с данными, подготовка, обучение и т.д.
3. Сохранение необходимых артефактов выполнения полезной работы в целевом бакете облачного хранилища (не удаляемого)
4. Удаление dataproc-кластера по завершению работы или по завершению одного из предыдущих шагов с ошибкой
5. Контроль корректного удаления

Это поможет минимизировать затраты на использование dataproc-кластера (т.к. мы будет платить только за время его фактического использования)

Среди ограничений предложенного подхода можно выделить:

- Возрастающие затраты на содержание простаивающего proxy (решаемо, т.к. его по-прежнему можно инициализировать по кнопке. В этом случае удаление придётся производить мануально, либо добавив соответствующие проверки по расписанию -- продумать реализацию)
- Увеличение времени ожидания (для каждой новой задачи потребуется всякий раз создавать заново и затем удалять соответствующую инфраструктуру). Это также значительно увеличит время отладки разрабатываемых программых продуктов.
- Отсутствие информирования об ошибках, а также неконтролируемость корректности выполнения всех шагов (в случае возникновения непредвиденных ошибок, например, при выполнении полезного кода или сохранении артефактов работы есть риск оставить развёрнутую инфраструктуры, пожирающую бюджет)
Это решается аккуратным написанием скриптов make compute и внимательной их отладкой, а также настройкой алёртинга.

Предложенный выше подход не был реализован в рамках данный работы.
